<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, shrink-to-fit=no user-scalable=0">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
  <link rel="icon"  href="/image/favicon.ico">
  <link rel="shortcut icon"  href="/image/favicon.ico">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/magnific-popup.css">
  <link rel="stylesheet" href="/css/jquery-ui.css">
  <link rel="stylesheet" href="/css/owl.carousel.min.css">
  <link rel="stylesheet" href="/css/owl.theme.default.min.css">
  <link rel="stylesheet" href="/css/bootstrap-datepicker.css">
  <link rel="stylesheet" href="/css/timedropper.css">
  <link rel="stylesheet" href="/css/animate.css">
  <link rel="stylesheet" href="/css/bootstrap-material-datetimepicker.css">
  <link rel="stylesheet" href="/css/aos.css">

  <link rel="stylesheet" href="/css/flaticon.css">
  <link rel="stylesheet" href="/css/icomoon.css">

  <link rel="stylesheet" href="/css/views/style.css">
  <link rel="stylesheet" href="/css/views/main.css">
  <link rel="stylesheet" href="/css/views/noncover.css">
  <link rel="stylesheet" href="/css/views/writepost.css">

  <link rel="stylesheet" href="/css/views/notice.css">
  <link rel="stylesheet" href="/css/views/writepost.css">
  <link rel="stylesheet" href="/css/views/ajaxloading.css">

</head>

<body>

  <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">

          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div> <!-- .site-mobile-menu -->

    <!--상단바-->
    <div class="site-navbar-wrap js-site-navbar bg-white">

      <div class="container">
        <div class="site-navbar bg-light">
          <div class="py-1">
            <div class="row align-items-center">
              <div class="col-10">
                <h2 class="mb-0 site-logo"></h2><a id="nav-title">
                  <%= title %>
                </a></h2>
              </div>
              <div class="col-2">
                <nav class="site-navigation text-right" role="navigation">
                  <div class="container">
                    <!-- d-lg-none -->
                    <div class="d-inline-block  ml-md-0 mr-auto py-3"><a href="#"
                        class="site-menu-toggle js-menu-toggle"><span class="icon-menu h3"></span></a></div>
                    <!-- d-lg-block -->
                    <ul class="site-menu js-clone-nav d-none" id="nav">
                      <% include ../nav/nav_case %>
                    </ul>
                  </div>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
  </div>

  <div class="site-section bg-light">
    <div class="container" id="writeForm">
      <div class="row" id="writeRow">
        <div id="write-form" class="col-lg-12">

          <div class="row form-group">
            <div class="col-md-12">
              <label class="font-weight-bold" for="password">상단고정</label>
              <div class="btn-group btn-group-toggle" data-toggle="buttons" id="attend-div">
                <label class="btn btn-danger">
                  <input type="radio" name="isadmin" id="re-radio1" value="1">
                  고정하기
                </label>
                <label class="btn btn-danger">
                  <input type="radio" name="isadmin" id="re-radio2" value="0">
                  고정안함
                </label>
              </div>
          </div>
            <div class="col-12" id="writeItem">
              <div class="writeDiv1">제목
              </div>
              <div class="writeDiv2"><input type="text" id="titleText" class="writeInput" maxlength="64"
                  onblur="inputLengthCheck(this);"></div>
            </div>
            <hr>
            <div class="col-12" id="writeContent">
              <textarea name="content" id="summernote" value=""></textarea>
            </div>
            <hr>

          </div>
        </div>

      </div>
      <div class="col-12" id="button-div">
        <a id="write-button" class="col-12 btn btn-primary px-4 py-2">
          <%=applyBtnText%>
        </a>
      </div>
    </div>
    <div id = "general-ajax-load"><!-- 로딩바 -->
      <img src="../image/loading-icon.gif"/>
      </div>

    </form>

  </div>
  </div>

</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
<script src="/js/lib/summernote/lang/summernote-ko-KR.js"></script>
<script src="/js/lib/jquery-migrate-3.0.1.min.js"></script>
<script src="/js/lib/jquery-ui.js"></script>
<script src="/js/lib/popper.min.js"></script>
<script src="/js/lib/owl.carousel.min.js"></script>
<script src="/js/lib/jquery.stellar.min.js"></script>
<script src="/js/lib/jquery.magnific-popup.min.js"></script>
<script src="/js/lib/aos.js"></script>

<script src="/js/views/main.js"></script>
<script src="/js/views/ajaxloading.js"></script>




<script type="text/javascript">

  $(document).ready(function () {

    
    $('#summernote').summernote({
      minHeight: 500,
      maxHeight: 1200,
      minWidth: 600,
      maxWidth: 700,
      disableResizeEditor: false,
      placeholder: '내용을 입력하세요',
      theme: 'simplex',
      lang: 'ko-KR',
      fontNames: ['맑은고딕', 'Arial'],
      fontNamesIgnoreCheck: ['맑은고딕'],
      toolbar: [
			    // [groupName, [list of button]]
			    ['fontname', ['fontname']],
			    ['fontsize', ['fontsize']],
			    ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
			    ['color', ['forecolor','color']],
			    ['table', ['table']],
			    ['para', ['ul', 'ol', 'paragraph']],
			    ['height', ['height']],
			    ['insert',['picture','link','video']],
			    ['view', ['fullscreen', 'help']]
			  ],
      popover: {
        image: [],
        link: [],
        air: []
      },
      callbacks : { 
            	onImageUpload : function(files, editor, welEditable) {
            // 파일 업로드(다중업로드를 위해 반복문 사용)
            for (var i = files.length - 1; i >= 0; i--) {
            uploadSummernoteImageFile(files[i],
            this);
            		}
            	}
      }
    });

    $("#summernote").on("summernote.enter", function (we, e) {
      $(this).summernote("pasteHTML", "<br><br>");
      e.preventDefault();
    })

    var loginStatus = "<%=loginStatus%>";
    var userId = "<%=userId%>";
    var username = "<%=username%>";

    
    if (loginStatus == "true") {
      $("#navProfileName").text("<%=username%>");
      $("#profileImageNav").attr("src", "<%=userImg%>");
      $("#navProfileLevel").text("LEVEL : " +"<%=userLevel%>");
      $("#navProfileGold").text("GOLD : " +"<%=userGold%>");
      if ("<%=userGender%>" == "" || "<%=userAge%>" == "") {
      }
    } else {
      $("#profileForm").css("display", "none");
    }

    $("#write-button").click(function () {

      var titleText = $("#titleText").val();
      var contentText = $("#summernote").summernote('code');

      var id = userId;

      var no;
      
      var isadmin = $('input[name=isadmin]:checked').val();

      if (titleText == "" || contentText == "" || isadmin == null) {
        alert("<%=writeErrorText%>");
      } else {
        var allData = {
          "id": userId,
          "titleText": titleText,
          "contentText": contentText,
          "name": username,
          "isAdmin":isadmin
        };
        
        $.ajax({
          url: "/notice/writenotice",
          data: allData,
          async: false,
          type: "post",
          contentType: "application/x-www-form-urlencoded; charset=UTF-8",
          success: function (data) {
            if (data['result'] == 'null') {
            } else {
              no = data['result'];
                alert("게시글 등록에 성공하였습니다.");
            location.href = "/notice";
            }
          },
          beforeSend: function () {
          },
          complete: function () {
          }
        });
      }
    });
  });

  function numberLengthCheck(eventInput) {
    var inputText = $(eventInput).val();
    if (inputText.replace(/[0-9]/g, "").length > 0) {
      $(eventInput).val('');
    }

    if (inputText < 2) {
      $(eventInput).val(2);
    }
    if (inputText > 100) {
      $(eventInput).val(100);
    }
  }

  function inputLengthCheck(eventInput) {
    var inputText = $(eventInput).val();
    var inputMaxLength = $(eventInput).prop("maxlength");

    var j = 0;
    var count = 0;

    for (var i = 0; i < inputText.length; i++) {
      val = escape(inputText.charAt(i)).length;
      if (val == 6) {
        j++;
      }
      j++;
      if (j <= inputMaxLength) {
        count++;
      }
    }
    if (j > inputMaxLength) {
      $(eventInput).val(inputText.substr(0, count));
    }
  }

  function uploadSummernoteImageFile(file, el) {
			data = new FormData();
			data.append("file", file);
			$.ajax({
				data : data,
				type : "POST",
				url : "/upload/uploadsummernote",
				contentType : false,
				enctype : 'multipart/form-data',
				processData : false,
				success : function(data) {
          console.log(data['result']);
					$(el).summernote('editor.insertImage', data['result']);
				}
			});
		}

</script>

</html>