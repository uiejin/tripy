<!DOCTYPE html>
<html>

<head>
  <title><%= title %></title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, shrink-to-fit=no user-scalable=0">

  <% include ../css/default %> 
  <link rel="stylesheet" href="//cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/e8bddc60e73c1ec2475f827be36e1957af72e2ea/build/css/bootstrap-datetimepicker.css">
  <link rel="stylesheet" href="/css/views/noncover.css">
  <link rel="stylesheet" href="/css/views/writepost.css">
  <link rel="stylesheet" href="/css/views/calendar.css">
</head>

<body>

  <div class="site-wrap">

    <% include ../head/cover %>

  <div class="site-section bg-light">
    <div class="container" id="writeForm">
      <div class="row" id="writeRow">
        <div id="write-form" class="col-lg-12">
          <div class="form-group">
            <!--자동수락 선택 버튼-->
            
            <!--입력 폼-->
            <div class="col-12" id="writeItem">
              <div class="writeDiv1"><%=writeText1%></div>
              <div class="writeDiv2" id="locationText"><%=locationText%></div>
            </div>
            <hr>
            <div class="col-12" id="writeItem">
              <div class="writeDiv1"><%=writeText2%></div>
              <div class="writeDiv2"><input type="text" id="selectdateText1" class="writeInput"></div>
            </div>
            <hr>
            <div class="col-12" id="writeItem">
              <div class="writeDiv1"><%=writeText3%></div>
              <div class="writeDiv2"><input type="text" id="selectdateText2" class="writeInput"></div>
            </div>
            <hr>
          </div>

        </div>
          <div class="col-12" id="button-div">
            <a id="back-button" class="btn btn-primary px-4 py-2" ><%=backBtnText%></a>
            <a id="write-button2" class="btn btn-primary px-4 py-2"><%=applyBtnText%></a>
          </div>
      </div>
    </div>

    <div id="s_id" data-prodnumber="${sessionScope.id}" />
    <div id="s_auth" data-prodnumber="${sessionScope.authority}" />

  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="modalTitle"><%=locationText%></h5>
					<button type="button" class="close" id="close_popup" data-dimiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>					
				</div>
				<div class="row form-group" id="modal-form">
				<div class="form-group" id="modal-info">
				</div>
        <div class="col-md-12">
          <div id="areaForm"></div>
					</div>
				</div>								
			</div>
		</div>
  </div>


</body>
<% include ../script/default %>


<script type="text/javascript">
  $(document).ready(function () {

    var loginStatus  = "<%=loginStatus %>";
    var userId = "<%=userId%>";

    var areacode = null;

    var country =['대한민국', '중국','일본','베트남','태국','라오스','미얀마'];

    var date = new Date();
    date.setDate(date.getDate()-1);

    if(loginStatus  == "true"){

      $("#navProfileName").text("<%=username%>");
        $("#profileImageNav").attr("src", "<%=userImg%>");
      $("#navProfileLevel").text("LEVEL : " +"<%=userLevel%>");
      $("#navProfileGold").text("GOLD : " +"<%=userGold%>");
    }else{
      $("#nav").load("/html/nav_nologin.html");
    /*  var loginMessage = "<%=loginMessage%>";
      alert(loginMessage);
      history.back();
    */}

    $('#myModal').modal('show');

    $("#close_popup").click(function() {
  			
      $('#myModal').modal('hide');
    });
    $("#close_popup2").click(function() {
  			
      $('#myModal1').modal('hide');
    });


    for(i=0; i<country.length; i++){

      var addarea = "<div><a class=\"text-uppercase\" id=\"locationText\">"+country[i]+"</a></div>";

      $("#areaForm").append(addarea);

      var allData = {
        country : country[i]
      }

      $.ajax({
      url: "/writepost/getarea",
      data: allData,
			async: false,
			type: "get",
			success: function (data) {
        $.each(data.rows, function (index, item) {


          var addarea = "<div id=\"locationSectionFirst\">" +
          "<button class=\"btn btn-primary locationBtn\" type=\"submit\" id=\"locationBtn"+item.AREA_CODE+"\" style=\"background-image: linear-gradient( rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5) ), url("+item.IMG+");\">" 
           +item.AREA +"</button></div>";

           $("#areaForm").append(addarea);

           $("#locationBtn"+item.AREA_CODE).click(function(){
              $('#locationText').text(item.AREA);
              areacode = item.AREA_CODE;

              $('#myModal').modal('hide');
              $("#nav-title").text("<%=selectdateText%>");
              $("#selectdateText1").trigger("click");
              
            });

        });
        
			},
			beforeSend: function () {
			},
			complete: function () {
			}
    });
    }


    $("#selectdateText1").trigger("click");$("#selectdateText2").trigger("click");
    

    $("#locationText").click(function(){
      $('#myModal').modal('show');
    });

    $('#selectdateText1').click(function(){
        $('#selectdateText1').datepicker({
        startDate: new Date,
        endDate : new Date(new Date().setDate(new Date().getDate() + 180)),
        format: "yyyy-mm-dd",
        autoclose: true,
        onSelect: function (dateText, inst) {
        }
      }).datepicker('show').on('hide', function(ev) { // <-----------
        $("#nav-title").text("<%=selectdateText2%>");
          $("#selectdateText2").trigger("click");
    });
      
    });

    $('#selectdateText2').click(function(){
        $('#selectdateText2').datepicker({
        startDate: $("#selectdateText1").val(),
        endDate : new Date(new Date().setDate(new Date().getDate() + 180)),
        format: "yyyy-mm-dd",
        autoclose: true,
        onSelect: function (dateText, inst) {
        }
      }).datepicker('show').datepicker('show').on('hide', function(ev) { // <-----------
        $("#nav-title").text("<%=title%>");
    });
      
    });

    $("#write-button2").click(function(){

      //var locationText = $("#locationText").val();
      //var cateText = $("#cateText").val();
        var meetDateText = $("#selectdateText1").val();
        var meetTimeText = $("#selectdateText2").val();
        var id = userId;
        var writerCountry = "korea";
        var limitAge = 5;
        var autoparticipation = $('input[name=autoparticipation]:checked').val();
        var limitGender = "NOTHING";


        
      var allData = {
            "areacode": areacode,
            "id": id,
            "startdate" : $("#selectdateText1").val(),
            "enddate" : $("#selectdateText2").val()
    };
    
		$.ajax({
			url: "/mytour/registertour",
			data: allData,
			async: false,
			type: "get",
			success: function (data) {
        if(data['result'] == true){
          alert("여행 일정 등록에 성공하였습니다");
          history.back();
        }else{
          alert("여행 일정 등록에 실패하였습니다");
        };
			},
			beforeSend: function () {
			},
			complete: function () {
			}
		});

    });

    $("#back-button").click(function(){
      history.back();
    });
  });
</script>



</html>