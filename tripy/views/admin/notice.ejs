<!DOCTYPE html>
<html>

<head>
    <title>관리자 페이지</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, shrink-to-fit=no user-scalable=0">

  <link rel="icon"  href="/image/favicon.ico">
  <link rel="shortcut icon"  href="/image/favicon.ico">
 
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/magnific-popup.css">
    <link rel="stylesheet" href="/css/jquery-ui.css">
    <link rel="stylesheet" href="/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="/css/bootstrap-datepicker.css">
    <link href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/animate.css">

    <link rel="stylesheet" href="/css/aos.css">

    <link rel="stylesheet" href="/css/flaticon.css">
    <link rel="stylesheet" href="/css/icomoon.css">

    <link rel="stylesheet" href="/css/views/style.css">
    <link rel="stylesheet" href="/css/views/main.css">
    <link rel="stylesheet" href="/css/views/read.css">
    <link rel="stylesheet" href="/css/views/login.css">
    <link rel="stylesheet" href="/css/views/notice.css">
    <link rel="stylesheet" href="/css/views/admin.css">
</head>

<body>

    <div class="site-wrap">

        <div class="site-mobile-menu">
            <div class="site-mobile-menu-header">
                <div class="site-mobile-menu-close mt-3">

                    <span class="icon-close2 js-menu-toggle"></span>
                </div>
            </div>
            <div class="site-mobile-menu-body"></div>
        </div> <!-- .site-mobile-menu -->



        <div class="site-navbar-wrap js-site-navbar bg-white">

            <div class="container">
                <div class="site-navbar bg-light">
                    <div class="py-1">
                        <div class="row align-items-center">
                            <div class="col-10">
                                <h2 class="mb-0 site-logo"><a>관리자 페이지 - 공지사항</a></h2>
                            </div>
                            <div class="col-2">
                                <nav class="site-navigation text-right" role="navigation">
                                    <div class="container">
                                        <!-- d-lg-none -->
                                        <div class="d-inline-block  ml-md-0 mr-auto py-3"><a href="#"
                                                class="site-menu-toggle js-menu-toggle"><span
                                                    class="icon-menu h3"></span></a></div>
                                        <!-- d-lg-block -->
                                        <ul class="site-menu js-clone-nav d-none" id="nav">
                                            <% include ../nav/nav_case %>
                                        </ul>
                                    </div>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="wrap-loading display-none">
        <div class="spinner-border text-primary display-none"></div>
    </div>

    <div class="site-section" style="padding-bottom: 10px; color:white">
        <div class="container">
            <div class="row">
                <div class="button_div">
                    <div>
                        <a id="update-button" class="btn btn-primary px-4 py-2">공지사항 삭제</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="site-section col-md-12" id="attendboardcontainer" style="padding-top: 10px;">
        <div class="row">
            <div class="container boardForm">
                <div class="row col-md-12" id="post">
                    <table class="table table-striped table-hover col-md-12">
                        <thead>
                            <tr>
                                <th scope="col"><input type="checkbox" id="chkall" /></th>
                                <th scope="col">no</th>
                                <th scope="col">제목</th>
                                <th scope="col">등록일</th>
                                <th scope="col">보기</th>
                                <th scope="col">수정</th>
                                <th scope="col">삭제</th>
                            </tr>
                        </thead>
                        <tbody id="table-body2">
                        </tbody>
                        <tbody id="table-body">
                        </tbody>
                    </table>



                    <div class="row col-md-12" id="pagenation-center">
                        <!--게시판 커스텀 -->
                        <nav aria-label="Page navigation example">
                            <ul class="pagination" id="paginationList">
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

</body>

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/lib/jquery-migrate-3.0.1.min.js"></script>
<script src="/js/lib/jquery-ui.js"></script>
<script src="/js/lib/popper.min.js"></script>
<script src="/js/lib/owl.carousel.min.js"></script>
<script src="/js/lib/jquery.stellar.min.js"></script>
<script src="/js/lib/jquery.magnific-popup.min.js"></script>
<script src="/js/lib/bootstrap-datepicker.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>
<script src="/js/lib/aos.js"></script>

<script src="/js/lib/mediaelement-and-player.min.js"></script>

<script src="/js/views/main.js"></script>

<script type="text/javascript">
    $(document).ready(function () {

        var loginStatus = "<%=loginStatus%>";
        var loginId = "<%=userId%>";
        var isAdmin = "<%=isAdmin%>";

        var pageSize = 10;
        var startNo = 0;
        var endNo = 10;
        var allDataSize = 0;
        var pageNo = 0;

        var ischecked = false;
        var isdelete = true;

        var allData = {
            "startNo": startNo,
            "endNo": endNo
        };
        if (loginStatus == "true" && isAdmin == '1') {

            $.ajax({
                url: "/notice/getnoticeall",
                async: false,
                type: "get",
                success: function (data) {
                    allDataSize = data.rows[0]['COUNT(*)'];
                    pageNo = allDataSize / pageSize;

                    if (allDataSize != 0) {
                        for (var i = 1; i < pageNo + 1; i++) {
                            var source = "<li class=\"page-item\"><a class=\"page-link\" href=\"#\">" + i + "</a></li>";

                            $("#paginationList").append(source);
                        }
                    }
                },
                beforeSend: function () {
                },
                complete: function () {
                }
            });
            $.ajax({
                url: "/notice/getnoticefavor",
                async: false,
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                type: "get",
                success: function (data) {
                    $.each(data.rows, function (index, item) {
                        var source = "<tr><th><input type=\"checkbox\" class=\"check_notice\" name=\"mycheck\" value=\"" + item.NO + "\"></th><th scope = \"row\">" + item.NO + "</th>";

                        source = source +
                            "<td>" + item.TITLE + "</td>";
                        var substrReg_date = item.REG_DATE.substr(0, 10);
                        source = source + "<td>" + substrReg_date + "</td>";

                        source = source + "<td><a id=\"changepassword" + item.NO + "\" class=\"btn btn-primary px-4 py-2 table-button\">" + '글보기' + '</a></td>';
                        source = source + "<td><a id=\"onlineclass" + item.NO + "\" class=\"btn btn-primary px-4 py-2 table-delete-button\" value=" + item.NO + ">" + '글 수정' + '</a></td>';
                        source = source + "<td><a id=\"deleteuser" + item.NO + "\" class=\"btn btn-primary px-4 py-2 table-delete-button\" value=" + item.NO + ">" + '글 삭제' + '</a></td></tr>';
                        $("#table-body2").append(source);
                        $("#check_notice" + item.NO).click(function () {
                            // 현재 클릭된 Row(<tr>)
                            var checkbox = $(this).find('td:first-child :checkbox');
                            checkbox.attr('checked', !checkbox.is(':checked'));

                        });

                        
                $('#changepassword' + item.NO).click(function () {
      location.href = "/notice/view?no=" + item.NO;
                });

                $('#onlineclass' + item.NO).click(function () {
                
                    modufyNotice(item.NO);  
                });

                $('#deleteuser' + item.NO).click(function () {
                 
                    deleteNotice(item.NO);
                 
                });
                    });

                },
                beforeSend: function () {
                },
                complete: function () {
                }
            });
            $.ajax({
                url: "/notice/getnotice",
                async: false,
                data: allData,
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                type: "get",
                success: function (data) {
                    $.each(data.rows, function (index, item) {
                        var source = "<tr><th><input type=\"checkbox\" class=\"check_notice\" name=\"mycheck\" value=\"" + item.NO + "\"></th><th scope = \"row\">" + item.NO + "</th>";
                        source = source +
                            "<td>" + item.TITLE + "</td>";
                        var substrReg_date = item.REG_DATE.substr(0, 10);
                        source = source + "<td>" + substrReg_date + "</td>";
                        source = source + "<td><a id=\"changepassword" + item.NO + "\" class=\"btn btn-primary px-4 py-2 table-button\">" + '글보기' + '</a></td>';
                        source = source + "<td><a id=\"onlineclass" + item.NO + "\" class=\"btn btn-primary px-4 py-2 table-delete-button\" value=" + item.NO + ">" + '글 수정' + '</a></td>';
                        source = source + "<td><a id=\"deleteuser" + item.NO + "\" class=\"btn btn-primary px-4 py-2 table-delete-button\" value=" + item.NO + ">" + '글 삭제' + '</a></td></tr>';
                        $("#table-body").append(source);
                        $("#check_notice" + item.NO).click(function () {
                            // 현재 클릭된 Row(<tr>)
                            var checkbox = $(this).find('td:first-child :checkbox');
                            checkbox.attr('checked', !checkbox.is(':checked'));
                        
                        });
                             
                $('#changepassword' + item.NO).click(function () {
      location.href = "/notice/view?no=" + item.NO;
                });

                $('#onlineclass' + item.NO).click(function () {
                
                    modufyNotice(item.NO);  
                });

                $('#deleteuser' + item.NO).click(function () {
                 
                    deleteNotice(item.NO);
                 
                });
                        
                    });


                },
                beforeSend: function () {
                },
                complete: function () {
                }
            });


            var pageItem = $(".pagination li").not(".prev,.next");

            pageItem.click(function () {
                pageItem.removeClass("active");
                $(this).not(".prev,.next").addClass("active");
                var no = $(this).text() - 1;
                startNo = pageSize * no;

                var allData = {
                    "startNo": startNo,
                    "endNo": endNo
                };

                $("#table-body").empty();
                $.ajax({
                    url: "/notice/getnotice",
                    async: false,
                    data: allData,
                    contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                    type: "get",
                    success: function (data) {
                        $.each(data.rows, function (index, item) {
                            var source = "<tr><th><input type=\"checkbox\" class=\"check_notice\" name=\"mycheck\" value=\"" + item.NO + "\"></th><th scope = \"row\">" + item.NO + "</th>";
                            source = source +
                                "<td>" + item.TITLE + "</td>";
                            var substrReg_date = item.REG_DATE.substr(0, 10);
                            source = source + "<td>" + substrReg_date + "</td>";
                            source = source + "<td><a id=\"changepassword" + item.NO + "\" class=\"btn btn-primary px-4 py-2 table-button\">" + '글보기' + '</a></td>';
                            source = source + "<td><a id=\"onlineclass" + item.NO + "\" class=\"btn btn-primary px-4 py-2 table-delete-button\" value=" + item.NO + ">" + '글 수정' + '</a></td>';
                            source = source + "<td><a id=\"deleteuser" + item.NO + "\" class=\"btn btn-primary px-4 py-2 table-delete-button\" value=" + item.NO + ">" + '글 삭제' + '</a></td></tr>';
                            $("#table-body").append(source);
                            $("#check_notice" + item.NO).click(function () {
                                // 현재 클릭된 Row(<tr>)
                                var checkbox = $(this).find('td:first-child :checkbox');
                                checkbox.attr('checked', !checkbox.is(':checked'));

                            });
                                 
                $('#changepassword' + item.NO).click(function () {
      location.href = "/notice/view?no=" + item.NO;
                });

                $('#onlineclass' + item.NO).click(function () {
                
                    modufyNotice(item.NO);  
                });

                $('#deleteuser' + item.NO).click(function () {
                 
                    deleteNotice(item.NO);
                 
                });
                        });
                        if (data.rows.length == 0) {
                            $("#attendboardcontainer").css("display", "none");
                        }
                    },
                    beforeSend: function () {
                    },
                    complete: function () {
                    }
                });
            });
            $("#chkall").click(function () {
                if (!ischecked) {
                    $("input[name=mycheck]:checkbox").prop("checked", true);
                    ischecked = true;
                } else {
                    $("input[name=mycheck]:checkbox").prop("checked", false);
                    ischecked = false;
                }
            });


            $("#update-button").click(function () {
                var checkedValue = null;
                var inputElements = document.getElementsByClassName('check_notice');
                for (var i = 0; inputElements[i]; ++i) {
                    if (inputElements[i].checked) {
                        deleteNotice(inputElements[i].value);
                    }

                }
                if (isdelete)
                    alert("게시글 삭제에 성공했습니다");
                else
                    alert("게시글을 삭제하지 못했습니다");
                location.reload();

            });

            function deleteNotice(no) {
                $.ajax({
                    url: "/notice/deletenotice",
                    data: { "no": no },
                    async: false,
                    type: "post",
                    success: function (data) {
                        if (data['result'] == true) {

                        } else {

                            isdelete = false;
                        }
                    },
                    beforeSend: function () {
                    },
                    complete: function () {
                    }
                });
            }

            function modufyNotice(no){
                $.ajax({
          url: "/notice/getnoticeno",
          async: false,
          data:  { "no": no },
          contentType: "application/x-www-form-urlencoded; charset=UTF-8",
          type: "post",
          success: function (data) {
            if (data['result'] == false) {
              alert("error.");
            } else {
                
                location.replace("/notice/update");
            }
          },
          beforeSend: function () {
          },
          complete: function () {
          }
        });
        }


        }
    });

</script>



</html>